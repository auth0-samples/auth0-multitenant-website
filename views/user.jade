extends layout

block content

  - var tenants = user._json.groups
  img(src="#{user.picture}")
  h2 Welcome #{user.nickname}!
  div Tenants: #{tenants}
  br
  a(href='/logout') Logout

  div
    span Switch Tenants
    select(id="tenant-select" onchange="switchTenant(this.value)")
      - each tenant in tenants
        option(value=tenant) #{tenant}

  script.
    var switchTenant = function (tenant) {
      var url = '//' + tenant.toLowerCase() + '.#{host}/user';
      window.location.href = url;
    };

    var setDefaultTenant = function() {
      var tenantSelect = document.getElementById('tenant-select');
      var options = tenantSelect.options;
      var currentTenant = '#{currentTenant}';
      if (!currentTenant) return;

      for (var i = 0; i < options.length; i++) {
        if (options[i].value.toLowerCase() == currentTenant) {
          options[i].defaultSelected = true;
          break;
        }
      }
    };

    document.onload = (function() {
      setDefaultTenant();
    })();
